<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photobooth Dzika</title>

<style>
body {
  margin:0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.container {
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,0.25);
  width:100%;
  max-width:420px;
  text-align:center;
}

/* Camera */
.video-wrapper {
  width:100%;
  border-radius:15px;
  overflow:hidden;
}

video {
  width:100%;
  height:auto;
  display:block;
  border-radius:15px;
}

/* Button */
button {
  margin-top:15px;
  padding:12px 25px;
  border:none;
  border-radius:30px;
  background:#667eea;
  color:white;
  font-size:16px;
  cursor:pointer;
  transition:0.3s;
}

button:hover {
  background:#5a67d8;
}

/* Preview */
.preview-wrapper {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:15px;
}

.preview-wrapper img {
  width:100%;
  border-radius:15px;
  object-fit:cover;
}

/* Result Card */
.result-card {
  margin-top:20px;
  background:#f9f9f9;
  padding:15px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
  display:none;
  flex-direction:column;
  gap:15px;
}

.result-card img {
  width:100%;
  border-radius:15px;
  object-fit:cover;
}

/* Responsive */
@media (max-width:480px){
  .container{
    max-width:95%;
  }
}
</style>
</head>
<body>

<div class="container">

  <!-- CAMERA -->
  <div id="cameraSection">
    <div class="video-wrapper">
      <video id="video" autoplay playsinline></video>
    </div>
    <button id="captureBtn">Ambil Foto (3)</button>

    <!-- PREVIEW (dibawah button) -->
    <div class="preview-wrapper" id="previewWrapper"></div>
  </div>

  <!-- RESULT -->
  <div class="result-card" id="resultCard"></div>

</div>

<script>
const video = document.getElementById('video');
const captureBtn = document.getElementById('captureBtn');
const previewWrapper = document.getElementById('previewWrapper');
const resultCard = document.getElementById('resultCard');
const cameraSection = document.getElementById('cameraSection');

let photoCount = 0;
let photos = [];
let stream;

/* Start Camera */
navigator.mediaDevices.getUserMedia({ video: true })
.then(s => {
  stream = s;
  video.srcObject = stream;
});

/* Capture */
captureBtn.addEventListener('click', () => {

  if(photoCount >= 3) return;

  let countdown = 3;
  captureBtn.innerText = countdown;

  const timer = setInterval(() => {
    countdown--;
    captureBtn.innerText = countdown;

    if(countdown === 0){
      clearInterval(timer);
      captureBtn.innerText = `Ambil Foto (${3 - photoCount - 1})`;
      takePhoto();
    }
  },1000);

});

function takePhoto(){

  const canvas = document.createElement('canvas');

  // IKUTI RASIO ASLI KAMERA (ANTI GEPENG)
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext('2d');

  // TANPA MIRROR
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imgData = canvas.toDataURL('image/png');
  photos.push(imgData);

  // PREVIEW SEBELUM 3 FOTO
  if(photoCount < 2){
    const img = document.createElement('img');
    img.src = imgData;
    previewWrapper.appendChild(img);
  }

  photoCount++;

  if(photoCount === 3){
    finishSession();
  }
}

function finishSession(){

  // Matikan kamera
  stream.getTracks().forEach(track => track.stop());

  // Sembunyikan camera & preview
  cameraSection.style.display = "none";

  // Tampilkan card hasil
  resultCard.style.display = "flex";

  photos.forEach(photo => {
    const img = document.createElement('img');
    img.src = photo;
    resultCard.appendChild(img);
  });

}
</script>

</body>
</html>
